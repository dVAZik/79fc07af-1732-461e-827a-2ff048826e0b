-- ModMenuLibrary.lua (ModuleScript)
local ModMenuLibrary = {}
ModMenuLibrary.__index = ModMenuLibrary

-- Цвета и настройки
local DEFAULT_COLORS = {
    Background = Color3.fromRGB(30, 30, 40),
    Button = Color3.fromRGB(70, 130, 230),
    ToggleOn = Color3.fromRGB(0, 200, 100),
    ToggleOff = Color3.fromRGB(200, 60, 60),
    Text = Color3.fromRGB(255, 255, 255),
    Slider = Color3.fromRGB(100, 180, 255),
    Border = Color3.fromRGB(60, 60, 80)
}

-- Вспомогательные функции
local function createDraggable(frame, handle)
    handle = handle or frame
    local dragging = false
    local dragInput, dragStart, startPos

    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Конструктор меню
function ModMenuLibrary.new(menuName)
    local self = setmetatable({}, ModMenuLibrary)
    
    self.MenuName = menuName or "Mod Menu"
    self.Elements = {}
    self.Sections = {}
    self.CurrentSection = nil
    
    -- Создаем основной GUI
    self:CreateMainGUI()
    
    return self
end

-- Создание основного интерфейса
function ModMenuLibrary:CreateMainGUI()
    -- Основной GUI
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "ModMenu"
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Основное окно
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Size = UDim2.new(0, 320, 0, 400)
    self.MainFrame.Position = UDim2.new(0.5, -160, 0.5, -200)
    self.MainFrame.BackgroundColor3 = DEFAULT_COLORS.Background
    self.MainFrame.BackgroundTransparency = 0.1
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.ClipsDescendants = true
    
    -- Скругленные углы
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 12)
    uiCorner.Parent = self.MainFrame
    
    -- Тень
    local uiShadow = Instance.new("UIStroke")
    uiShadow.Color = Color3.fromRGB(0, 0, 0)
    uiShadow.Thickness = 2
    uiShadow.Transparency = 0.8
    uiShadow.Parent = self.MainFrame
    
    -- Заголовок (панель перетаскивания)
    self.TitleBar = Instance.new("Frame")
    self.TitleBar.Size = UDim2.new(1, 0, 0, 40)
    self.TitleBar.BackgroundColor3 = DEFAULT_COLORS.Border
    self.TitleBar.BorderSizePixel = 0
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12, 0, 0)
    titleCorner.Parent = self.TitleBar
    
    -- Название меню
    self.TitleLabel = Instance.new("TextLabel")
    self.TitleLabel.Size = UDim2.new(1, -50, 1, 0)
    self.TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    self.TitleLabel.BackgroundTransparency = 1
    self.TitleLabel.Text = self.MenuName
    self.TitleLabel.TextColor3 = DEFAULT_COLORS.Text
    self.TitleLabel.TextSize = 18
    self.TitleLabel.Font = Enum.Font.GothamBold
    self.TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Кнопка скрытия/показа
    self.ToggleButton = Instance.new("TextButton")
    self.ToggleButton.Size = UDim2.new(0, 40, 0, 40)
    self.ToggleButton.Position = UDim2.new(1, -40, 0, 0)
    self.ToggleButton.BackgroundTransparency = 1
    self.ToggleButton.Text = "━"
    self.ToggleButton.TextColor3 = DEFAULT_COLORS.Text
    self.ToggleButton.TextSize = 20
    self.ToggleButton.Font = Enum.Font.GothamBold
    
    self.ToggleButton.MouseButton1Click:Connect(function()
        self:ToggleMenu()
    end)
    
    -- Контейнер для элементов
    self.ContentFrame = Instance.new("Frame")
    self.ContentFrame.Size = UDim2.new(1, -20, 1, -60)
    self.ContentFrame.Position = UDim2.new(0, 10, 0, 50)
    self.ContentFrame.BackgroundTransparency = 1
    self.ContentFrame.ClipsDescendants = true
    
    -- Scrolling frame для элементов
    self.ScrollingFrame = Instance.new("ScrollingFrame")
    self.ScrollingFrame.Size = UDim2.new(1, 0, 1, 0)
    self.ScrollingFrame.BackgroundTransparency = 1
    self.ScrollingFrame.BorderSizePixel = 0
    self.ScrollingFrame.ScrollBarThickness = 4
    self.ScrollingFrame.ScrollBarImageColor3 = DEFAULT_COLORS.Border
    self.ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    
    local uiListLayout = Instance.new("UIListLayout")
    uiListLayout.Padding = UDim.new(0, 5)
    uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    
    -- Собираем интерфейс
    self.TitleLabel.Parent = self.TitleBar
    self.ToggleButton.Parent = self.TitleBar
    self.TitleBar.Parent = self.MainFrame
    uiListLayout.Parent = self.ScrollingFrame
    self.ScrollingFrame.Parent = self.ContentFrame
    self.ContentFrame.Parent = self.MainFrame
    self.MainFrame.Parent = self.ScreenGui
    
    -- Делаем перетаскиваемым
    createDraggable(self.MainFrame, self.TitleBar)
    
    -- Плавающая кнопка для открытия
    self:CreateFloatingButton()
end

-- Плавающая кнопка для мобильных
function ModMenuLibrary:CreateFloatingButton()
    self.FloatingButton = Instance.new("TextButton")
    self.FloatingButton.Size = UDim2.new(0, 60, 0, 60)
    self.FloatingButton.Position = UDim2.new(1, -70, 1, -70)
    self.FloatingButton.BackgroundColor3 = DEFAULT_COLORS.Button
    self.FloatingButton.Text = "☰"
    self.FloatingButton.TextColor3 = DEFAULT_COLORS.Text
    self.FloatingButton.TextSize = 24
    self.FloatingButton.Visible = false
    self.FloatingButton.ZIndex = 1000
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.5, 0)
    corner.Parent = self.FloatingButton
    
    local shadow = Instance.new("UIStroke")
    shadow.Color = Color3.fromRGB(0, 0, 0)
    shadow.Thickness = 2
    shadow.Parent = self.FloatingButton
    
    self.FloatingButton.MouseButton1Click:Connect(function()
        self:ShowMenu()
    end)
    
    self.FloatingButton.Parent = self.ScreenGui
end

-- Основные методы управления
function ModMenuLibrary:Show()
    self.ScreenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    self:ShowMenu()
end

function ModMenuLibrary:Hide()
    self.ScreenGui.Parent = nil
end

function ModMenuLibrary:ToggleMenu()
    self.MainFrame.Visible = not self.MainFrame.Visible
    self.FloatingButton.Visible = not self.MainFrame.Visible
end

function ModMenuLibrary:ShowMenu()
    self.MainFrame.Visible = true
    self.FloatingButton.Visible = false
end

function ModMenuLibrary:HideMenu()
    self.MainFrame.Visible = false
    self.FloatingButton.Visible = true
end

-- Секции меню
function ModMenuLibrary:CreateSection(name)
    local section = {
        Name = name,
        Elements = {}
    }
    
    table.insert(self.Sections, section)
    self.CurrentSection = section
    
    -- Визуальный разделитель
    local divider = Instance.new("Frame")
    divider.Size = UDim2.new(1, 0, 0, 2)
    divider.BackgroundColor3 = DEFAULT_COLORS.Border
    divider.BorderSizePixel = 0
    
    local sectionLabel = Instance.new("TextLabel")
    sectionLabel.Size = UDim2.new(1, 0, 0, 25)
    sectionLabel.BackgroundTransparency = 1
    sectionLabel.Text = name
    sectionLabel.TextColor3 = DEFAULT_COLORS.Text
    sectionLabel.TextSize = 16
    sectionLabel.Font = Enum.Font.GothamBold
    sectionLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    divider.LayoutOrder = #self.Elements * 2
    sectionLabel.LayoutOrder = #self.Elements * 2 + 1
    
    divider.Parent = self.ScrollingFrame
    sectionLabel.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, divider)
    table.insert(self.Elements, sectionLabel)
    
    -- Обновляем размер контента
    task.spawn(function()
        wait(0.1)
        self:UpdateCanvasSize()
    end)
    
    return section
end

function ModMenuLibrary:UpdateCanvasSize()
    local totalHeight = 0
    for _, element in pairs(self.ScrollingFrame:GetChildren()) do
        if element:IsA("GuiObject") and element.Visible then
            totalHeight = totalHeight + element.AbsoluteSize.Y + 5
        end
    end
    
    self.ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
end

-- ЭЛЕМЕНТЫ МЕНЮ

-- Кнопка
function ModMenuLibrary:AddButton(name, callback)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, 0, 0, 40)
    buttonFrame.BackgroundColor3 = DEFAULT_COLORS.Button
    buttonFrame.BackgroundTransparency = 0.2
    buttonFrame.BorderSizePixel = 0
    buttonFrame.LayoutOrder = #self.Elements + 1
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = buttonFrame
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundTransparency = 1
    button.Text = name
    button.TextColor3 = DEFAULT_COLORS.Text
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    
    button.MouseButton1Click:Connect(function()
        if callback then
            callback()
        end
    end)
    
    -- Эффект нажатия
    button.MouseButton1Down:Connect(function()
        game:GetService("TweenService"):Create(buttonFrame, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.4
        }):Play()
    end)
    
    button.MouseButton1Up:Connect(function()
        game:GetService("TweenService"):Create(buttonFrame, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.2
        }):Play()
    end)
    
    button.Parent = buttonFrame
    buttonFrame.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, buttonFrame)
    self:UpdateCanvasSize()
    
    return buttonFrame
end

-- Переключатель (Toggle)
function ModMenuLibrary:AddToggle(name, defaultState, callback)
    local toggleState = defaultState or false
    
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(1, 0, 0, 35)
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.LayoutOrder = #self.Elements + 1
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = DEFAULT_COLORS.Text
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 50, 0, 25)
    toggleButton.Position = UDim2.new(1, -50, 0.5, -12)
    toggleButton.BackgroundColor3 = toggleState and DEFAULT_COLORS.ToggleOn or DEFAULT_COLORS.ToggleOff
    toggleButton.Text = ""
    toggleButton.BorderSizePixel = 0
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = toggleButton
    
    local toggleCircle = Instance.new("Frame")
    toggleCircle.Size = UDim2.new(0, 19, 0, 19)
    toggleCircle.Position = toggleState and UDim2.new(1, -21, 0.5, -9.5) or UDim2.new(0, 2, 0.5, -9.5)
    toggleCircle.BackgroundColor3 = DEFAULT_COLORS.Text
    toggleCircle.BorderSizePixel = 0
    
    local circleCorner = Instance.new("UICorner")
    circleCorner.CornerRadius = UDim.new(0.5, 0)
    circleCorner.Parent = toggleCircle
    
    toggleButton.MouseButton1Click:Connect(function()
        toggleState = not toggleState
        
        game:GetService("TweenService"):Create(toggleButton, TweenInfo.new(0.2), {
            BackgroundColor3 = toggleState and DEFAULT_COLORS.ToggleOn or DEFAULT_COLORS.ToggleOff
        }):Play()
        
        game:GetService("TweenService"):Create(toggleCircle, TweenInfo.new(0.2), {
            Position = toggleState and UDim2.new(1, -21, 0.5, -9.5) or UDim2.new(0, 2, 0.5, -9.5)
        }):Play()
        
        if callback then
            callback(toggleState)
        end
    end)
    
    toggleCircle.Parent = toggleButton
    label.Parent = toggleFrame
    toggleButton.Parent = toggleFrame
    toggleFrame.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, toggleFrame)
    self:UpdateCanvasSize()
    
    return {
        SetState = function(state)
            toggleState = state
            toggleButton.BackgroundColor3 = toggleState and DEFAULT_COLORS.ToggleOn or DEFAULT_COLORS.ToggleOff
            toggleCircle.Position = toggleState and UDim2.new(1, -21, 0.5, -9.5) or UDim2.new(0, 2, 0.5, -9.5)
        end,
        GetState = function()
            return toggleState
        end
    }
end

-- Текст бокс с кнопкой
function ModMenuLibrary:AddTextBox(name, placeholder, buttonText, callback, inputCount)
    inputCount = inputCount or 1
    
    local textBoxFrame = Instance.new("Frame")
    textBoxFrame.Size = UDim2.new(1, 0, 0, 35 * inputCount + 10)
    textBoxFrame.BackgroundTransparency = 1
    textBoxFrame.LayoutOrder = #self.Elements + 1
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = DEFAULT_COLORS.Text
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local textBoxes = {}
    local values = {}
    
    for i = 1, inputCount do
        local inputFrame = Instance.new("Frame")
        inputFrame.Size = UDim2.new(1, 0, 0, 30)
        inputFrame.Position = UDim2.new(0, 0, 0, 20 + (i-1)*35)
        inputFrame.BackgroundColor3 = DEFAULT_COLORS.Border
        inputFrame.BackgroundTransparency = 0.7
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 6)
        corner.Parent = inputFrame
        
        local textBox = Instance.new("TextBox")
        textBox.Size = UDim2.new(0.7, 0, 1, 0)
        textBox.Position = UDim2.new(0, 5, 0, 0)
        textBox.BackgroundTransparency = 1
        textBox.Text = ""
        textBox.PlaceholderText = placeholder or "Введите текст..."
        textBox.TextColor3 = DEFAULT_COLORS.Text
        textBox.PlaceholderColor3 = Color3.fromRGB(180, 180, 180)
        textBox.TextSize = 14
        textBox.Font = Enum.Font.Gotham
        textBox.TextXAlignment = Enum.TextXAlignment.Left
        textBox.ClearTextOnFocus = false
        
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(0.25, -10, 0.8, 0)
        button.Position = UDim2.new(0.75, 5, 0.1, 0)
        button.BackgroundColor3 = DEFAULT_COLORS.Button
        button.Text = buttonText or "OK"
        button.TextColor3 = DEFAULT_COLORS.Text
        button.TextSize = 12
        button.Font = Enum.Font.Gotham
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 4)
        btnCorner.Parent = button
        
        textBox.Parent = inputFrame
        button.Parent = inputFrame
        inputFrame.Parent = textBoxFrame
        
        table.insert(textBoxes, {
            frame = inputFrame,
            textBox = textBox,
            button = button,
            index = i
        })
        
        values[i] = ""
        
        button.MouseButton1Click:Connect(function()
            values[i] = textBox.Text
            if callback then
                callback(values, i)
            end
        end)
    end
    
    label.Parent = textBoxFrame
    textBoxFrame.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, textBoxFrame)
    self:UpdateCanvasSize()
    
    return {
        GetValues = function()
            return values
        end,
        SetValue = function(index, value)
            if textBoxes[index] then
                textBoxes[index].textBox.Text = value
                values[index] = value
            end
        end,
        ClearAll = function()
            for _, tb in ipairs(textBoxes) do
                tb.textBox.Text = ""
                values[tb.index] = ""
            end
        end
    }
end

-- Выбор из списка (Dropdown)
function ModMenuLibrary:AddDropdown(name, options, defaultIndex, callback, isMultiSelect)
    isMultiSelect = isMultiSelect or false
    local selected = {}
    local isOpen = false
    
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(1, 0, 0, 35)
    dropdownFrame.BackgroundTransparency = 1
    dropdownFrame.ClipsDescendants = true
    dropdownFrame.LayoutOrder = #self.Elements + 1
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = DEFAULT_COLORS.Text
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local mainButton = Instance.new("TextButton")
    mainButton.Size = UDim2.new(1, 0, 0, 30)
    mainButton.Position = UDim2.new(0, 0, 0, 20)
    mainButton.BackgroundColor3 = DEFAULT_COLORS.Border
    mainButton.BackgroundTransparency = 0.7
    mainButton.Text = "Выберите..."
    mainButton.TextColor3 = DEFAULT_COLORS.Text
    mainButton.TextSize = 13
    mainButton.Font = Enum.Font.Gotham
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = mainButton
    
    local arrow = Instance.new("TextLabel")
    arrow.Size = UDim2.new(0, 20, 0, 20)
    arrow.Position = UDim2.new(1, -25, 0.5, -10)
    arrow.BackgroundTransparency = 1
    arrow.Text = "▼"
    arrow.TextColor3 = DEFAULT_COLORS.Text
    arrow.TextSize = 12
    
    local optionsFrame = Instance.new("Frame")
    optionsFrame.Size = UDim2.new(1, 0, 0, 0)
    optionsFrame.Position = UDim2.new(0, 0, 0, 55)
    optionsFrame.BackgroundColor3 = DEFAULT_COLORS.Background
    optionsFrame.BackgroundTransparency = 0.3
    optionsFrame.Visible = false
    optionsFrame.ClipsDescendants = true
    
    local optionsCorner = Instance.new("UICorner")
    optionsCorner.CornerRadius = UDim.new(0, 6)
    optionsCorner.Parent = optionsFrame
    
    local optionsList = Instance.new("UIListLayout")
    optionsList.Padding = UDim.new(0, 2)
    
    -- Создаем опции
    local optionButtons = {}
    
    local function updateButtonText()
        if isMultiSelect then
            local selectedText = ""
            for i, opt in ipairs(options) do
                if selected[i] then
                    selectedText = selectedText .. opt .. ", "
                end
            end
            mainButton.Text = selectedText == "" and "Выберите..." or selectedText:sub(1, -3)
        else
            for i, _ in ipairs(options) do
                if selected[i] then
                    mainButton.Text = options[i]
                    break
                end
            end
        end
    end
    
    local function toggleOption(index)
        if isMultiSelect then
            selected[index] = not selected[index]
            optionButtons[index].BackgroundColor3 = selected[index] and DEFAULT_COLORS.Button or DEFAULT_COLORS.Border
        else
            for i, _ in ipairs(options) do
                selected[i] = false
                if optionButtons[i] then
                    optionButtons[i].BackgroundColor3 = DEFAULT_COLORS.Border
                end
            end
            selected[index] = true
            optionButtons[index].BackgroundColor3 = DEFAULT_COLORS.Button
            isOpen = false
            optionsFrame.Visible = false
            dropdownFrame.Size = UDim2.new(1, 0, 0, 35)
        end
        
        updateButtonText()
        
        if callback then
            local selectedValues = {}
            for i, opt in ipairs(options) do
                if selected[i] then
                    table.insert(selectedValues, opt)
                end
            end
            callback(isMultiSelect and selectedValues or options[index])
        end
    end
    
    for i, option in ipairs(options) do
        local optionButton = Instance.new("TextButton")
        optionButton.Size = UDim2.new(1, -10, 0, 25)
        optionButton.Position = UDim2.new(0, 5, 0, (i-1)*27)
        optionButton.BackgroundColor3 = DEFAULT_COLORS.Border
        optionButton.BackgroundTransparency = 0.5
        optionButton.Text = option
        optionButton.TextColor3 = DEFAULT_COLORS.Text
        optionButton.TextSize = 12
        optionButton.Font = Enum.Font.Gotham
        
        local optCorner = Instance.new("UICorner")
        optCorner.CornerRadius = UDim.new(0, 4)
        optCorner.Parent = optionButton
        
        optionButton.MouseButton1Click:Connect(function()
            toggleOption(i)
        end)
        
        optionButton.Parent = optionsFrame
        table.insert(optionButtons, optionButton)
    end
    
    if defaultIndex then
        if type(defaultIndex) == "table" then
            for _, idx in ipairs(defaultIndex) do
                selected[idx] = true
                optionButtons[idx].BackgroundColor3 = DEFAULT_COLORS.Button
            end
        else
            selected[defaultIndex] = true
            optionButtons[defaultIndex].BackgroundColor3 = DEFAULT_COLORS.Button
        end
        updateButtonText()
    end
    
    mainButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        optionsFrame.Visible = isOpen
        
        if isOpen then
            local optionCount = #options
            local maxHeight = math.min(optionCount * 27 + 10, 150)
            optionsFrame.Size = UDim2.new(1, 0, 0, maxHeight)
            dropdownFrame.Size = UDim2.new(1, 0, 0, 55 + maxHeight)
        else
            optionsFrame.Size = UDim2.new(1, 0, 0, 0)
            dropdownFrame.Size = UDim2.new(1, 0, 0, 35)
        end
    end)
    
    arrow.Parent = mainButton
    optionsList.Parent = optionsFrame
    label.Parent = dropdownFrame
    mainButton.Parent = dropdownFrame
    optionsFrame.Parent = dropdownFrame
    dropdownFrame.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, dropdownFrame)
    self:UpdateCanvasSize()
    
    return {
        SetOptions = function(newOptions)
            options = newOptions
            -- Обновляем список (упрощенно)
        end,
        GetSelected = function()
            local result = {}
            for i, opt in ipairs(options) do
                if selected[i] then
                    table.insert(result, opt)
                end
            end
            return isMultiSelect and result or result[1]
        end
    }
end

-- Слайдер
function ModMenuLibrary:AddSlider(name, minValue, maxValue, defaultValue, callback, decimalPlaces)
    decimalPlaces = decimalPlaces or 0
    local currentValue = defaultValue or minValue
    
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, 0, 0, 60)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.LayoutOrder = #self.Elements + 1
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name .. ": " .. currentValue
    label.TextColor3 = DEFAULT_COLORS.Text
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local sliderBackground = Instance.new("Frame")
    sliderBackground.Size = UDim2.new(1, 0, 0, 25)
    sliderBackground.Position = UDim2.new(0, 0, 0, 25)
    sliderBackground.BackgroundColor3 = DEFAULT_COLORS.Border
    sliderBackground.BackgroundTransparency = 0.7
    
    local bgCorner = Instance.new("UICorner")
    bgCorner.CornerRadius = UDim.new(0, 12)
    bgCorner.Parent = sliderBackground
    
    local sliderFill = Instance.new("Frame")
    sliderFill.Size = UDim2.new(0, 0, 1, 0)
    sliderFill.Position = UDim2.new(0, 0, 0, 0)
    sliderFill.BackgroundColor3 = DEFAULT_COLORS.Slider
    sliderFill.BorderSizePixel = 0
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 12)
    fillCorner.Parent = sliderFill
    
    local sliderButton = Instance.new("TextButton")
    sliderButton.Size = UDim2.new(0, 30, 0, 30)
    sliderButton.Position = UDim2.new(0, -15, 0.5, -15)
    sliderButton.BackgroundColor3 = DEFAULT_COLORS.Text
    sliderButton.Text = ""
    sliderButton.ZIndex = 2
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0.5, 0)
    btnCorner.Parent = sliderButton
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Size = UDim2.new(0, 40, 0, 20)
    valueLabel.Position = UDim2.new(0, -20, -1.5, 0)
    valueLabel.BackgroundColor3 = DEFAULT_COLORS.Background
    valueLabel.BackgroundTransparency = 0.3
    valueLabel.Text = tostring(currentValue)
    valueLabel.TextColor3 = DEFAULT_COLORS.Text
    valueLabel.TextSize = 12
    valueLabel.Visible = false
    
    local valCorner = Instance.new("UICorner")
    valCorner.CornerRadius = UDim.new(0, 4)
    valCorner.Parent = valueLabel
    
    -- Обновление положения слайдера
    local function updateSlider(positionX)
        local relativeX = math.clamp(positionX, 0, sliderBackground.AbsoluteSize.X)
        local percentage = relativeX / sliderBackground.AbsoluteSize.X
        local value = minValue + (maxValue - minValue) * percentage
        
        if decimalPlaces == 0 then
            value = math.floor(value + 0.5)
        else
            value = math.floor(value * (10 ^ decimalPlaces) + 0.5) / (10 ^ decimalPlaces)
        end
        
        currentValue = math.clamp(value, minValue, maxValue)
        
        sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
        sliderButton.Position = UDim2.new(percentage, -15, 0.5, -15)
        label.Text = name .. ": " .. currentValue
        valueLabel.Text = tostring(currentValue)
        
        if callback then
            callback(currentValue)
        end
    end
    
    -- Инициализация
    updateSlider((defaultValue - minValue) / (maxValue - minValue) * sliderBackground.AbsoluteSize.X)
    
    -- Взаимодействие
    local dragging = false
    
    sliderButton.MouseButton1Down:Connect(function()
        dragging = true
        valueLabel.Visible = true
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
            valueLabel.Visible = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.Touch then
            local pos = input.Position
            local relativePos = pos.X - sliderBackground.AbsolutePosition.X
            updateSlider(relativePos)
        end
    end)
    
    sliderBackground.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            local relativePos = input.Position.X - sliderBackground.AbsolutePosition.X
            updateSlider(relativePos)
            dragging = true
            valueLabel.Visible = true
        end
    end)
    
    sliderFill.Parent = sliderBackground
    valueLabel.Parent = sliderButton
    sliderButton.Parent = sliderBackground
    label.Parent = sliderFrame
    sliderBackground.Parent = sliderFrame
    sliderFrame.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, sliderFrame)
    self:UpdateCanvasSize()
    
    return {
        SetValue = function(value)
            local percentage = (value - minValue) / (maxValue - minValue)
            updateSlider(percentage * sliderBackground.AbsoluteSize.X)
        end,
        GetValue = function()
            return currentValue
        end
    }
end

-- Выбор цвета
function ModMenuLibrary:AddColorPicker(name, defaultColor, callback)
    local currentColor = defaultColor or Color3.fromRGB(255, 255, 255)
    
    local colorFrame = Instance.new("Frame")
    colorFrame.Size = UDim2.new(1, 0, 0, 35)
    colorFrame.BackgroundTransparency = 1
    colorFrame.LayoutOrder = #self.Elements + 1
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = DEFAULT_COLORS.Text
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local colorButton = Instance.new("TextButton")
    colorButton.Size = UDim2.new(0, 50, 0, 25)
    colorButton.Position = UDim2.new(1, -50, 0.5, -12)
    colorButton.BackgroundColor3 = currentColor
    colorButton.Text = ""
    colorButton.BorderSizePixel = 0
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = colorButton
    
    -- Палитра цветов (скрыта по умолчанию)
    local paletteFrame = Instance.new("Frame")
    paletteFrame.Size = UDim2.new(0, 150, 0, 120)
    paletteFrame.Position = UDim2.new(1, 5, 0, 0)
    paletteFrame.BackgroundColor3 = DEFAULT_COLORS.Background
    paletteFrame.BackgroundTransparency = 0.1
    paletteFrame.Visible = false
    paletteFrame.ZIndex = 10
    
    local paletteCorner = Instance.new("UICorner")
    paletteCorner.CornerRadius = UDim.new(0, 8)
    paletteCorner.Parent = paletteFrame
    
    -- Предопределенные цвета
    local presetColors = {
        Color3.fromRGB(255, 0, 0),    -- Красный
        Color3.fromRGB(0, 255, 0),    -- Зеленый
        Color3.fromRGB(0, 0, 255),    -- Синий
        Color3.fromRGB(255, 255, 0),  -- Желтый
        Color3.fromRGB(255, 0, 255),  -- Пурпурный
        Color3.fromRGB(0, 255, 255),  -- Голубой
        Color3.fromRGB(255, 255, 255),-- Белый
        Color3.fromRGB(0, 0, 0)       -- Черный
    }
    
    for i, color in ipairs(presetColors) do
        local row = math.floor((i-1)/4)
        local col = (i-1) % 4
        
        local presetButton = Instance.new("TextButton")
        presetButton.Size = UDim2.new(0, 30, 0, 30)
        presetButton.Position = UDim2.new(0, 10 + col*35, 0, 10 + row*35)
        presetButton.BackgroundColor3 = color
        presetButton.Text = ""
        presetButton.BorderSizePixel = 0
        
        local presetCorner = Instance.new("UICorner")
        presetCorner.CornerRadius = UDim.new(0, 6)
        presetCorner.Parent = presetButton
        
        presetButton.MouseButton1Click:Connect(function()
            currentColor = color
            colorButton.BackgroundColor3 = currentColor
            paletteFrame.Visible = false
            
            if callback then
                callback(currentColor)
            end
        end)
        
        presetButton.Parent = paletteFrame
    end
    
    colorButton.MouseButton1Click:Connect(function()
        paletteFrame.Visible = not paletteFrame.Visible
    end)
    
    paletteFrame.Parent = colorButton
    label.Parent = colorFrame
    colorButton.Parent = colorFrame
    colorFrame.Parent = self.ScrollingFrame
    
    table.insert(self.Elements, colorFrame)
    self:UpdateCanvasSize()
    
    return {
        SetColor = function(color)
            currentColor = color
            colorButton.BackgroundColor3 = color
            if callback then
                callback(color)
            end
        end,
        GetColor = function()
            return currentColor
        end
    }
end

-- Специальные селекторы
function ModMenuLibrary:AddPlayerSelector(name, multiSelect, callback)
    local players = game:GetService("Players"):GetPlayers()
    local playerNames = {}
    
    for _, player in ipairs(players) do
        table.insert(playerNames, player.Name)
    end
    
    return self:AddDropdown(name, playerNames, nil, callback, multiSelect)
end

function ModMenuLibrary:AddItemSelector(name, items, multiSelect, callback)
    return self:AddDropdown(name, items, nil, callback, multiSelect)
end

-- Экспорт
return ModMenuLibrary
